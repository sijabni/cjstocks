<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Safe-Aggressive Portfolio Monitor</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f4f9; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { color: #0078d4; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* Form Styling */
        .controls { display: flex; gap: 10px; margin-bottom: 20px; background: #eef5fb; padding: 15px; border-radius: 5px; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; flex: 1; }
        
        /* Button Styling */
        button { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: #28a745; color: white; }
        .btn-refresh { background: #0078d4; color: white; }
        .btn-delete { background: #dc3545; color: white; padding: 4px 8px; font-size: 12px; }
        button:hover { opacity: 0.8; }

        /* Table Styling */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background-color: #f8f9fa; color: #555; text-transform: uppercase; font-size: 13px; }
        .gain { color: #28a745; font-weight: bold; }
        .loss { color: #dc3545; font-weight: bold; }
        
        #status { font-style: italic; color: #666; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ðŸ“ˆ Portfolio Performance</h2>
    
    <div id="status">Ready.</div>

    <div class="controls">
        <input type="text" id="tickerInput" placeholder="Ticker (e.g. NVDA)">
        <input type="number" id="sharesInput" placeholder="Shares">
        <button class="btn-add" onclick="saveStock()">Save Stock</button>
        <button class="btn-refresh" onclick="fetchPortfolio()">Refresh List</button>
    </div>

    <table id="portfolioTable">
        <thead>
            <tr>
                <th>Ticker</th>
                <th>Shares</th>
                <th>Gain/Loss</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>
</div>

<script>
    const API_URL = 'https://cjstocks-gpgmhnf0eba9c8c8.canadacentral-01.azurewebsites.net/api/get_portfolio';

    // 1. FETCH & DISPLAY
    async function fetchPortfolio() {
        const status = document.getElementById('status');
        const tableBody = document.querySelector('#portfolioTable tbody');
        status.innerText = "Synchronizing with Azure...";
        
        try {
            const response = await fetch(API_URL);
            const data = await response.json();
            
            tableBody.innerHTML = ""; 
            data.forEach(item => {
                const isGain = parseFloat(item.gain_loss) >= 0;
                const row = `<tr>
                    <td><strong>${item.ticker}</strong></td>
                    <td>${item.shares}</td>
                    <td class="${isGain ? 'gain' : 'loss'}">$${item.gain_loss}</td>
                    <td>
                        <button class="btn-delete" onclick="deleteStock('${item.ticker}')">Delete</button>
                    </td>
                </tr>`;
                tableBody.innerHTML += row;
            });
            status.innerText = "Update complete.";
        } catch (err) {
            status.innerText = "Connection error.";
            console.error(err);
        }
    }

    // 2. ADD OR UPDATE (POST/PUT)
    async function saveStock() {
        const ticker = document.getElementById('tickerInput').value.toUpperCase();
        const shares = document.getElementById('sharesInput').value;

        if (!ticker || !shares) return alert("Please enter both ticker and shares.");

        document.getElementById('status').innerText = `Saving ${ticker}...`;

        try {
            const response = await fetch(API_URL, {
                method: 'POST', // Or PUT depending on your API design
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ticker, shares })
            });

            if (response.ok) {
                document.getElementById('tickerInput').value = "";
                document.getElementById('sharesInput').value = "";
                fetchPortfolio(); // Refresh display
            }
        } catch (err) {
            alert("Error saving data.");
        }
    }

    // 3. DELETE
    async function deleteStock(ticker) {
        if (!confirm(`Remove ${ticker} from portfolio?`)) return;

        document.getElementById('status').innerText = `Deleting ${ticker}...`;

        try {
            const response = await fetch(`${API_URL}?ticker=${ticker}`, {
                method: 'DELETE'
            });

            if (response.ok) fetchPortfolio();
        } catch (err) {
            alert("Error deleting stock.");
        }
    }

    // Initial Load
    fetchPortfolio();
</script>

</body>
</html>